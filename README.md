# LOL BP 网站使用说明

本文档面向第一次使用该 BP 网站的裁判、队伍成员与旁观者，帮助你快速完成：创建房间、进入房间、设置对局规则、开始 BP、跨局管理（BO / Fearless）以及常见问题排查。

## 1. 这个网站能做什么

这是一个面向《英雄联盟》BP 场景的网页工具，核心能力包括：

- 创建与加入房间（房间号 6 位）。
- 多身份进入（`TEAM_A` / `TEAM_B` / `REFEREE` / `SPECTATOR`）。
- 支持 `BO1/BO2/BO3/BO5`。
- 支持两种模式：`STANDARD` 与 `FEARLESS`。
- 支持每手计时：30s / 60s / 90s / 不限时。
- 支持“地图蓝红方”和“BP 先手”分离设置。
- 裁判可执行：开始、暂停、恢复、撤销一步、重置。
- 内置聊天（仅裁判与队伍可发言，旁观者不可发）。
- 断线重连与房间状态持久化（服务端落盘）。

## 2. 快速开始（用户视角）

### 2.1 进入首页

打开网站后有两个入口：

- `Create Room`：创建新房间。
- `Join Room`：输入房间号加入已有房间。

### 2.2 创建房间（建议由裁判操作）

在 `Create Room` 中填写或选择：

- 比赛名称 `Match Title`（可留空）。
- 队伍名 `Team A Name` / `Team B Name`。
- 赛制 `BO1 / BO2 / BO3 / BO5`。
- 模式 `STANDARD / FEARLESS`。
- 每手时间 `30 / 60 / 90 / ∞`。
- 是否开启“地图与 BP 顺序分离”。

点击 `创建房间(CREATE ROOM)` 后：

1. 系统会创建房间并生成链接（含 `?room=xxxxxx`）。
2. 前端会自动尝试复制链接到剪贴板。
3. 将该链接发给双方队伍与旁观者。

### 2.3 加入房间

两种方式：

- 直接打开邀请链接（推荐）。
- 或在 `Join Room` 手动输入房间号后点 `CONNECT`。

进入房间后会弹出身份选择：

- `TEAM_A`
- `TEAM_B`
- `REFEREE`
- `SPECTATOR`

> 注意：同一房间内，`TEAM_A / TEAM_B / REFEREE` 属于“独占会话身份”。若同身份在其他设备登录，旧连接会被强制下线。

## 3. 对局流程（标准操作顺序）

### 3.1 赛前配置

1. **选择蓝红方**：
   - 若未开启“地图与 BP 分离”，选择哪队为蓝色方即可。
   - 若已开启分离，需要额外指定“BP 首选队伍”，最后点“确认”。
2. **双方 Ready**：蓝红两侧都需 `READY`。
3. **裁判开始**：裁判点击开始按钮（`Play` 图标）进入 BP。

### 3.2 BP 阶段

- 按系统顺序进行 Ban/Pick（内置完整 20 手流程）。
- 当前可操作方可在英雄池中点击英雄并锁定。
- 支持搜索（中文、英文、拼音模糊）。
- 额外特殊项：
  - `NO BAN`（不禁用）
  - `RANDOM`（随机英雄）

### 3.3 Swap 阶段

BP 结束后进入交换阶段（`SWAP PHASE`）：

- 点击同侧两个英雄可交换位置。
- 队伍仅能操作自己阵营，裁判可操作双方。

### 3.4 局结束与下一局

- 裁判上报胜者后进入下一局（若未达到 BO 终局）。
- 在 `FEARLESS` 下，前局已被双方选过的英雄会在后续局全局禁用。
- 比分会显示在顶部（如 `Team A 1 - 0 Team B`）。

## 4. 功能说明（按角色）

### 4.1 裁判（REFEREE）

可使用完整控制功能：

- 开始对局
- 暂停 / 恢复
- 撤销上一步
- 重置当前局
- 上报胜者
- 与双方聊天

### 4.2 队伍（TEAM_A / TEAM_B）

- 在轮到自己阵营时进行 Ban/Pick。
- 可切换 `READY` 状态。
- 可在 Swap 阶段交换己方英雄。
- 可使用聊天。

### 4.3 旁观者（SPECTATOR）

- 仅观看，不可操作 BP。
- 不可发送聊天消息。

## 5. 房间与数据说明

服务端会将每个房间的数据写入本地 JSON 文件，包括：

- 当前房间状态
- 历史 action（用于重放/补齐）
- 聊天记录（保留最近 N 条）

因此服务端重启后，房间通常可以从磁盘恢复。

## 6. 本地运行（开发者）

> 当前前端代码默认连接固定线上地址（`https://zijing.yejiaxin.online` / `wss://zijing.yejiaxin.online`）。
> 若要全本地联调，需要把这些地址改为本地服务地址。

### 6.1 安装依赖

```bash
npm install
```

### 6.2 一键启动（前后端并行）

```bash
npm run dev
```

默认会并行启动：

- `apps/server`：WebSocket + HTTP
- `apps/web`：Vite 前端

### 6.3 常用单独命令

```bash
npm run dev --workspace=apps/server
npm run dev --workspace=apps/web
npm run build --workspace=apps/web
```

## 7. 常见问题

### Q1：为什么我操作不了？

常见原因：

- 你是 `SPECTATOR`。
- 还没轮到你这边。
- 当前处于暂停状态。
- 赛前未完成蓝红方配置与双方 Ready。

### Q2：为什么身份突然退出？

你的身份（裁判/队伍）被其他设备以相同角色登录了。系统会保留最新连接，并让旧连接退出。

### Q3：聊天发不出去？

- 旁观者不能发送。
- 单条消息长度上限为 300 字符。

### Q4：断线后怎么办？

页面会尝试维持连接与状态同步。若网络恢复后仍异常，刷新页面并重新进入房间即可。

---

如果你是赛事执行同学，建议固定流程为：

1. 裁判建房并发链接。  
2. 双方选择角色后先确认蓝红与 BP 先手。  
3. 双方 Ready，裁判再开始。  
4. 每局结束立即上报结果，避免赛后统一补录。  

这样最稳，也最不容易出错。
